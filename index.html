<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Expense Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-md">
    <h1 class="text-2xl font-bold mb-4 text-center">🏡 Home Expenses Tracker</h1>

    <label class="block mb-2 font-semibold">Income:</label>
    <input id="income" type="number" class="w-full p-2 border rounded mb-4" placeholder="Enter your income" />

    <div id="expenseList" class="space-y-2"></div>

    <button onclick="addExpenseField()" class="bg-blue-500 text-white px-4 py-2 rounded mt-4">+ Add Other Expense</button>
    <br>

    <button onclick="calculateTotal()" class="bg-green-600 text-white font-semibold mt-6 px-6 py-2 rounded-full w-full">📊 Calculate</button>
  </div>

  <script>
    const expenseList = document.getElementById('expenseList');
    const defaultExpenses = [
      ["💡 Utility", ""],
      ["🔌 Electricity Expenses", ""],
      ["🛢️ Gas Cylinder", ""],
      ["🥛 Milk Expenses", ""],
      ["🧹 Sweeper", ""],
      ["💊 Mama Medicine", ""],
      ["👩‍👧 Umama Expenses", ""],
      ["🌐 Internet Charges", ""],
      ["⛽ Petrol Charges", ""],
      ["🏫 School Fees", ""],
      ["📚 Tuition Fees", ""],
      ["🕋 Qari Fees", ""],
      ["🛺 Rikshaw Expenses", ""],
      ["🚗 Petrol Expenses", ""]
    ];

    window.onload = () => {
      defaultExpenses.forEach(([label, value]) => addExpenseField(label, value));
    };

    function addExpenseField(label = '', value = '') {
      const div = document.createElement('div');
      div.className = 'flex items-center gap-2';

      div.innerHTML = `
        <input type="text" placeholder="Expense Category" class="flex-1 p-2 border rounded" value="${label}" />
        <input type="number" placeholder="Amount" class="w-32 p-2 border rounded" value="${value}" />
        <button onclick="this.parentElement.remove()" class="text-red-600">➖</button>
      `;

      expenseList.appendChild(div);
    }

    function calculateTotal() {
      const income = parseInt(document.getElementById('income').value) || 0;
      const categories = [];
      let total = 0;

      document.querySelectorAll('#expenseList > div').forEach(row => {
        const label = row.children[0].value.trim();
        const amount = parseInt(row.children[1].value) || 0;
        if (label) {
          categories.push([label, amount]);
          total += amount;
        }
      });

      const netSavings = income - total;

      const payload = {
        income,
        total,
        netSavings,
        categories
      };

      sendToGoogleSheet(payload);
    }

    function sendToGoogleSheet(data) {
      const formData = new FormData();
      formData.append('income', data.income);
      formData.append('total', data.total);
      formData.append('netSavings', data.netSavings);

      data.categories.forEach(([label, amount], i) => {
        formData.append(`label${i + 1}`, label);
        formData.append(`amount${i + 1}`, amount);
      });

      fetch('https://script.google.com/macros/s/AKfycbzf029RqMotdb-LFCr7Lpw-8SEGHuMkukUHA7xPb6Bwt12VwJDWByx_IKzqO7yf-gbjZg/exec', {
        method: 'POST',
        body: formData
      })
      .then(res => res.text())
      .then(response => {
        alert("✅ Data sent successfully");
        console.log("✅ Response:", response);
      })
      .catch(err => console.error("❌ Error sending to Google Sheet:", err));
    }
  </script>
</body>
</html>
